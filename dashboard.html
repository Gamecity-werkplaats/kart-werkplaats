<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kart Problemen Dashboard</title>
<style>
:root {
  --bg:#0f1115; --fg:#f0f0f0; --accent:#00c896;
  --card:#1a1d24; --border:#2a2d34;
  --open:#e74c3c; --solved:#27ae60; --shadow:rgba(0,0,0,0.4);
}
body.light {
  --bg:#f8f8f8; --fg:#111; --accent:#00846a;
  --card:#fff; --border:#ccc; --open:#c0392b;
  --solved:#27ae60; --shadow:rgba(0,0,0,0.1);
}
body {
  background:var(--bg); color:var(--fg);
  font-family:"Segoe UI",sans-serif; margin:0; transition:background .3s,color .3s;
}

/* Header */
header {
  display:flex; justify-content:space-between; align-items:center;
  background:var(--card); padding:15px 25px;
  box-shadow:0 2px 10px var(--shadow); position:sticky; top:0; z-index:100;
}
h1 {font-size:1.4rem;}
#modeToggle {
  background:var(--accent); border:none; border-radius:50%; width:38px; height:38px;
  color:#fff; font-size:18px; cursor:pointer;
}

/* Main layout */
main {max-width:1100px; margin:auto; padding:20px;}

/* Stats */
.stats {
  display:flex; flex-wrap:wrap; justify-content:space-around;
  gap:10px; margin-bottom:25px;
}
.stat {
  flex:1; min-width:180px; text-align:center;
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; box-shadow:0 2px 10px var(--shadow);
  padding:15px;
}
.stat h2 {margin:0; font-size:2rem;}
.stat p {margin:5px 0 0; color:#aaa;}

/* Form */
form,.filters {
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; padding:15px; margin-bottom:20px;
  box-shadow:0 2px 10px var(--shadow);
}
input,select,button {
  padding:8px; margin:5px; border-radius:5px;
  border:1px solid var(--border); background:#222; color:var(--fg);
}
body.light input,body.light select,body.light button{background:#fff;color:#000;}
button{cursor:pointer;background:var(--accent);color:#fff;border:none;}
button:hover{opacity:.9;}

/* Cards */
.cards {
  display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:15px;
}
.card {
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; box-shadow:0 2px 10px var(--shadow);
  padding:12px 15px; display:flex; flex-direction:column; justify-content:space-between;
}
.card.open {border-left:6px solid var(--open);}
.card.opgelost {border-left:6px solid var(--solved);opacity:.85;}
.card h3{margin:0;font-size:1.1rem;}
.card small{color:#aaa;}
.status{font-weight:bold;color:var(--accent);}
.solveBtn {
  background:var(--solved);margin-top:8px;
}
.solveBtn:disabled{background:#444;cursor:not-allowed;}
</style>
</head>
<body>
<header>
  <h1>üèéÔ∏è Kart Problemen Dashboard</h1>
  <button id="modeToggle">‚òÄÔ∏è</button>
</header>

<main>
  <!-- Dashboard -->
  <div class="stats">
    <div class="stat"><h2 id="totalProblems">0</h2><p>Totaal meldingen</p></div>
    <div class="stat"><h2 id="openProblems">0</h2><p>Karts met problemen</p></div>
    <div class="stat"><h2 id="workingKarts">0</h2><p>Werkende karts</p></div>
  </div>

  <!-- Nieuwe melding -->
  <form id="addForm">
    <select id="kart" required><option value="">Kart...</option></select>
    <input id="probleem" placeholder="Probleem" required>
    <input id="melder" placeholder="Melder" required>
    <button type="submit">‚ûï Toevoegen</button>
  </form>

  <!-- Filters -->
  <div class="filters">
    <label>Kart:
      <select id="filterKart">
        <option value="">Alle</option>
      </select>
    </label>
    <label>Status:
      <select id="filterStatus">
        <option value="">Alle</option>
        <option value="open">Open</option>
        <option value="opgelost">Opgelost</option>
      </select>
    </label>
    <button id="clearFilters">‚ùå Wissen</button>
  </div>

  <!-- Cards -->
  <div class="cards" id="cards"></div>
</main>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbyV2YCK6qVc60A-ktS33beE5T7wupJXadiyn_hHPtsXIrP5tq5aIIjHCacLq_LE8yryig/exec";
for(let i=1;i<=40;i++){
  document.querySelector("#kart").innerHTML+=`<option>${i}</option>`;
  document.querySelector("#filterKart").innerHTML+=`<option>${i}</option>`;
}
let all=[];

// Ophalen data
async function load(){
  const r=await fetch(SHEET_URL);
  const d=await r.json();
  all=d.slice(1).map(r=>({datum:r[0],kart:r[1],probleem:r[2],melder:r[3],status:r[4]||"open"}));
  renderDashboard(); renderCards();
}

// Dashboard cijfers
function renderDashboard(){
  const total=all.length;
  const openKarts=new Set(all.filter(p=>p.status==="open").map(p=>p.kart)).size;
  document.getElementById("totalProblems").textContent=total;
  document.getElementById("openProblems").textContent=openKarts;
  document.getElementById("workingKarts").textContent=40-openKarts;
}

// Kaarten weergeven
function renderCards(){
  const kartF=document.getElementById("filterKart").value;
  const statF=document.getElementById("filterStatus").value;
  const c=document.getElementById("cards"); c.innerHTML="";
  all.filter(p=>(!kartF||p.kart==kartF)&&(!statF||p.status==statF))
     .reverse()
     .forEach(p=>{
        const div=document.createElement("div");
        div.className=`card ${p.status}`;
        div.innerHTML=`
          <h3>Kart ${p.kart}</h3>
          <p>${p.probleem}</p>
          <small>${p.datum} ‚Äì ${p.melder}</small>
          <p class="status">${p.status}</p>
          <button class="solveBtn" ${p.status==="opgelost"?"disabled":""}
            onclick="solve('${p.kart}','${p.probleem}')">‚úÖ Markeer als opgelost</button>`;
        c.appendChild(div);
     });
}

// Nieuwe melding
document.getElementById("addForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const body={action:"add",datum:new Date().toLocaleDateString("nl-NL"),
    kart:document.getElementById("kart").value,
    probleem:document.getElementById("probleem").value,
    melder:document.getElementById("melder").value,
    status:"open"};
  await fetch(SHEET_URL,{method:"POST",body:JSON.stringify(body)});
  e.target.reset(); load();
});

// Markeer als opgelost
async function solve(kart,probleem){
  await fetch(SHEET_URL,{method:"POST",body:JSON.stringify({action:"solve",kart,probleem})});
  load();
}

// Filters
document.getElementById("filterKart").addEventListener("change",renderCards);
document.getElementById("filterStatus").addEventListener("change",renderCards);
document.getElementById("clearFilters").addEventListener("click",()=>{document.getElementById("filterKart").value="";document.getElementById("filterStatus").value="";renderCards();});

// Dark/light mode
const body=document.body, toggle=document.getElementById("modeToggle");
toggle.addEventListener("click",()=>{body.classList.toggle("light");toggle.textContent=body.classList.contains("light")?"üåô":"‚òÄÔ∏è";});

load();
</script>
</body>
</html>
