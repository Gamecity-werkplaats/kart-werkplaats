<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kart Problemen Dashboard</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="css/styles.css?v=20251107">
  <meta name="theme-color" content="#00c896">
</head>
<body>
  <header>
    <h1>ğŸï¸ Kart Problemen Dashboard</h1>
    <button id="modeToggle">â˜€ï¸</button>
  </header>

  <main>
    <div id="syncStatus" class="sync-status">ğŸ Bezig met ladenâ€¦</div>

    <div class="stats">
      <div class="stat"><h2 id="totalProblems">0</h2><p>Totaal meldingen</p></div>
      <div class="stat"><h2 id="openProblems">0</h2><p>Open meldingen</p></div>
      <div class="stat"><h2 id="workingKarts">0</h2><p>Werkende karts</p></div>
    </div>

    <!-- Add form -->
    <form id="addForm">
      <select id="kart" required><option value="">Kart...</option></select>
      <input id="probleem" placeholder="Probleem" required>
      <input id="melder" placeholder="Melder" required>
      <button id="addBtn" type="submit">â• Toevoegen</button>
    </form>

    <!-- Custom filter toolbar -->
    <div class="filters">
      <details class="filter-dropdown" id="kartFilter">
        <summary>ğŸï¸ Kart: <span class="filter-label">Alle</span></summary>
        <div class="filter-options" id="kartOptions"></div>
      </details>

      <details class="filter-dropdown" id="statusFilter">
        <summary>ğŸ“‹ Status: <span class="filter-label">Alle</span></summary>
        <div class="filter-options" id="statusOptions">
          <div data-value="">Alle</div>
          <div data-value="open">Open</div>
          <div data-value="resolved">Opgelost</div>
        </div>
      </details>

      <button id="clearFilters" class="clear-filters">âŒ Wissen</button>
    </div>

    <div id="cardsContainer"></div>
  </main>

  <script src="js/app.js?v=20251107"></script>

  <!-- ğŸ” PIN Overlay -->
  <div id="pinOverlay" aria-hidden="false">
    <div id="pinCard" role="dialog" aria-modal="true" aria-labelledby="pinTitle">
      <h3 id="pinTitle">Voer pincode in</h3>
      <div id="pinDisplay">----</div>
      <div class="pinKeypad" id="pinKeypad">
        <div class="pinKey">1</div><div class="pinKey">2</div><div class="pinKey">3</div>
        <div class="pinKey">4</div><div class="pinKey">5</div><div class="pinKey">6</div>
        <div class="pinKey">7</div><div class="pinKey">8</div><div class="pinKey">9</div>
        <div class="pinKey">â†</div><div class="pinKey">0</div>
        <div class="pinKey wide" id="pinEnter">Ontgrendel</div>
      </div>
      <div id="pinError" aria-live="polite"></div>
    </div>
  </div>

  <script>
  // === PIN Screen ===
  const CORRECT_PIN = "3120"; // change to your code
  const overlay = document.getElementById("pinOverlay");
  const display = document.getElementById("pinDisplay");
  const error = document.getElementById("pinError");
  const keypad = document.getElementById("pinKeypad");
  let entered = "";

  function renderPin() {
    display.textContent = (entered.replace(/\d/g, "â€¢") + "----").slice(0,4);
    error.textContent = "";
  }

  function unlock() {
    if (entered === CORRECT_PIN) {
      overlay.classList.add("fadeOut");
      setTimeout(() => {
        overlay.style.display = "none";
        overlay.setAttribute("aria-hidden", "true");
      }, 300);
    } else {
      error.textContent = "Onjuiste pincode";
      entered = "";
      renderPin();
    }
  }

  function tryAutoUnlock() {
    if (entered.length === 4) setTimeout(unlock, 150);
  }

  keypad.addEventListener("click", e => {
    const key = e.target.textContent.trim();
    if (!key) return;
    if (key === "â†") entered = entered.slice(0,-1);
    else if (key === "Ontgrendel") unlock();
    else if (/^\d$/.test(key) && entered.length < 4) {
      entered += key;
      tryAutoUnlock();
    }
    renderPin();
  });

  window.addEventListener("keydown", e => {
    if (overlay.style.display === "none") return;
    if (/^\d$/.test(e.key) && entered.length < 4) {
      entered += e.key;
      tryAutoUnlock();
    } else if (e.key === "Backspace") entered = entered.slice(0,-1);
    else if (e.key === "Enter") unlock();
    renderPin();
  });

  renderPin();
  </script>
</body>
</html>
