<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kart Problemen Dashboard</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00c896">
<style>
:root {
  --bg:#0f1115; --fg:#f0f0f0; --accent:#00c896;
  --card:#1a1d24; --border:#2a2d34;
  --open:#e74c3c; --solved:#27ae60; --shadow:rgba(0,0,0,0.4);
}
body.light {
  --bg:#f8f8f8; --fg:#111; --accent:#00846a;
  --card:#fff; --border:#ccc; --open:#c0392b;
  --solved:#27ae60; --shadow:rgba(0,0,0,0.1);
}
body {
  background:var(--bg); color:var(--fg);
  font-family:"Segoe UI",sans-serif; margin:0;
  transition:background .3s,color .3s;
}

/* Header */
header {
  display:flex; justify-content:space-between; align-items:center;
  background:var(--card); padding:15px 25px;
  box-shadow:0 2px 10px var(--shadow); position:sticky; top:0; z-index:100;
}
h1 {font-size:1.4rem;}
#modeToggle {
  background:var(--accent); border:none; border-radius:50%;
  width:38px; height:38px; color:#fff; font-size:18px; cursor:pointer;
}

/* Sync indicator */
#syncStatus {
  font-size:0.85rem; color:#aaa; text-align:center; margin-top:8px;
}

/* Layout */
main {max-width:1100px; margin:auto; padding:20px;}

/* Stats */
.stats {
  display:flex; flex-wrap:wrap; justify-content:space-around;
  gap:10px; margin-bottom:25px;
}
.stat {
  flex:1; min-width:180px; text-align:center;
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; box-shadow:0 2px 10px var(--shadow);
  padding:15px;
}
.stat h2 {margin:0; font-size:2rem;}
.stat p {margin:5px 0 0; color:#aaa;}

/* Forms */
form,.filters {
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; padding:15px; margin-bottom:20px;
  box-shadow:0 2px 10px var(--shadow);
}
input,select,button {
  padding:8px; margin:5px; border-radius:5px;
  border:1px solid var(--border); background:#222; color:var(--fg);
}
body.light input,body.light select,body.light button{background:#fff;color:#000;}
button{cursor:pointer;background:var(--accent);color:#fff;border:none;}
button:hover{opacity:.9;}

/* Cards */
.cards {
  display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:15px;
}
.card {
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; box-shadow:0 2px 10px var(--shadow);
  padding:12px 15px; display:flex; flex-direction:column; justify-content:space-between;
}
.card.open {border-left:6px solid var(--open);}
.card.opgelost {border-left:6px solid var(--solved);opacity:.85;}
.card h3{margin:0;font-size:1.1rem;}
.card small{color:#aaa;}
.status{font-weight:bold;color:var(--accent);}
.solveBtn {background:var(--solved);margin-top:8px;}
.solveBtn:disabled{background:#444;cursor:not-allowed;}
<style>
  /* PIN overlay (zelfstandig, raakt jouw layout niet) */
  #pinOverlay {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.55);
    z-index: 99999; /* heel hoog zodat het boven alles zit */
  }
  #pinCard {
    background: #fff;
    border-radius: 10px;
    padding: 20px;
    width: 360px;
    max-width: 92%;
    box-shadow: 0 12px 36px rgba(0,0,0,0.4);
    text-align: center;
  }
  #pinTitle { margin:0 0 8px; font-size:18px; }
  #pinDisplay {
    height:48px;
    border-radius:8px;
    border:1px solid #eee;
    display:flex;
    align-items:center;
    justify-content:center;
    margin-bottom:12px;
    font-size:26px;
    letter-spacing:10px;
    background:#fbfbfb;
    user-select:none;
  }
  .pinKeypad {
    display:grid;
    grid-template-columns: repeat(3,1fr);
    gap:8px;
  }
  .pinKey {
    padding:12px;
    border-radius:8px;
    background:#f3f3f3;
    border:1px solid #e6e6e6;
    cursor:pointer;
    user-select:none;
    font-size:16px;
  }
  .pinKey:active { transform: translateY(1px); }
  .pinKey.wide { grid-column: 1 / -1; background:#111; color:#fff; font-weight:600; }
  #pinError { color:crimson; min-height:20px; margin-top:10px; font-size:13px; }
  @media (max-width:420px){
    #pinCard{ width:320px; padding:16px; }
    #pinDisplay{ font-size:22px; height:44px; letter-spacing:8px; }
  }
</style>
</head>
<body>
<header>
  <h1>üèéÔ∏è Kart Problemen Dashboard</h1>
  <button id="modeToggle">‚òÄÔ∏è</button>
</header>

<main>
  <div id="syncStatus" style="text-align:center; margin-top:10px; color:#ccc;">
  üèÅ Bezig met laden‚Ä¶
  </div>


  <div class="stats">
    <div class="stat"><h2 id="totalProblems">0</h2><p>Totaal meldingen</p></div>
    <div class="stat"><h2 id="openProblems">0</h2><p>Karts met problemen</p></div>
    <div class="stat"><h2 id="workingKarts">0</h2><p>Werkende karts</p></div>
  </div>

  <form id="addForm">
    <select id="kart" required><option value="">Kart...</option></select>
    <input id="probleem" placeholder="Probleem" required>
    <input id="melder" placeholder="Melder" required>
    <button type="submit">‚ûï Toevoegen</button>
  </form>

  <div class="filters">
    <label>Kart:
      <select id="filterKart"><option value="">Alle</option></select>
    </label>
    <label>Status:
      <select id="filterStatus">
        <option value="">Alle</option><option value="open">Open</option><option value="opgelost">Opgelost</option>
      </select>
    </label>
    <button id="clearFilters">‚ùå Wissen</button>
  </div>

  <div class="cards" id="cards"></div>
</main>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbyV2YCK6qVc60A-ktS33beE5T7wupJXadiyn_hHPtsXIrP5tq5aIIjHCacLq_LE8yryig/exec";

for(let i=1;i<=40;i++){
  document.querySelector("#kart").innerHTML+=`<option>${i}</option>`;
  document.querySelector("#filterKart").innerHTML+=`<option>${i}</option>`;
}

let all=[];
const syncStatus=document.getElementById("syncStatus");

async function load(){
  syncStatus.textContent="üîÑ Data verversen...";
  try{
    const r=await fetch(SHEET_URL+"?t="+Date.now()); // avoid caching
    const d=await r.json();
    all=d.slice(1).map(r=>({datum:r[0],kart:r[1],probleem:r[2],melder:r[3],status:r[4]||"open"}));
    renderDashboard(); renderCards();
    syncStatus.textContent="‚úÖ Gesynchroniseerd ("+new Date().toLocaleTimeString("nl-NL")+")";
  }catch(err){
    syncStatus.textContent="‚ö†Ô∏è Kon niet verbinden (offline?)";
  }
}

function renderDashboard(){
  const total=all.length;
  const openKarts=new Set(all.filter(p=>p.status==="open").map(p=>p.kart)).size;
  document.getElementById("totalProblems").textContent=total;
  document.getElementById("openProblems").textContent=openKarts;
  document.getElementById("workingKarts").textContent=40-openKarts;
}

function renderCards(){
  const kartF=document.getElementById("filterKart").value;
  const statF=document.getElementById("filterStatus").value;
  const c=document.getElementById("cards"); c.innerHTML="";
  all.filter(p=>(!kartF||p.kart==kartF)&&(!statF||p.status==statF))
     .reverse()
     .forEach(p=>{
        const div=document.createElement("div");
        div.className=`card ${p.status}`;
        div.innerHTML=`
          <h3>Kart ${p.kart}</h3>
          <p>${p.probleem}</p>
          <small>${p.datum} ‚Äì ${p.melder}</small>
          <p class="status">${p.status}</p>
          <button class="solveBtn" ${p.status==="opgelost"?"disabled":""}
            onclick="solve('${p.kart}','${p.probleem}')">‚úÖ Markeer als opgelost</button>`;
        c.appendChild(div);
     });
}

document.getElementById("addForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const body={action:"add",datum:new Date().toLocaleDateString("nl-NL"),
    kart:document.getElementById("kart").value,
    probleem:document.getElementById("probleem").value,
    melder:document.getElementById("melder").value,
    status:"open"};
  await fetch(SHEET_URL,{method:"POST",body:JSON.stringify(body)});
  e.target.reset(); load();
});

async function solve(kart,probleem){
  await fetch(SHEET_URL,{method:"POST",body:JSON.stringify({action:"solve",kart,probleem})});
  load();
}

// Filters
document.getElementById("filterKart").addEventListener("change",renderCards);
document.getElementById("filterStatus").addEventListener("change",renderCards);
document.getElementById("clearFilters").addEventListener("click",()=>{document.getElementById("filterKart").value="";document.getElementById("filterStatus").value="";renderCards();});

// Auto refresh every 60s
setInterval(load,60000);

// Dark/light mode
const body=document.body, toggle=document.getElementById("modeToggle");
toggle.addEventListener("click",()=>{body.classList.toggle("light");toggle.textContent=body.classList.contains("light")?"üåô":"‚òÄÔ∏è";});

// Register service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js')
    .then(()=>console.log("Service Worker ready"))
    .catch(console.error);
}

load();
<!-- PIN overlay (plak dit vlak voor </body>) -->
<div id="pinOverlay" aria-hidden="false">
  <div id="pinCard" role="dialog" aria-modal="true" aria-labelledby="pinTitle">
    <h3 id="pinTitle">Voer pincode in</h3>
    <div id="pinDisplay">----</div>

    <div class="pinKeypad" id="pinKeypad">
      <div class="pinKey">1</div>
      <div class="pinKey">2</div>
      <div class="pinKey">3</div>
      <div class="pinKey">4</div>
      <div class="pinKey">5</div>
      <div class="pinKey">6</div>
      <div class="pinKey">7</div>
      <div class="pinKey">8</div>
      <div class="pinKey">9</div>
      <div class="pinKey">‚Üê</div>
      <div class="pinKey">0</div>
      <div class="pinKey wide" id="pinEnter">Ontgrendel</div>
    </div>

    <div id="pinError" aria-live="polite"></div>
    </div>
  </div>
</div>

<script>
  // --- Simpele pincode overlay (client-side) ---
  // Pas hier de pincode aan:
  const CORRECT_PIN = '3120';

  const overlay = document.getElementById('pinOverlay');
  const pinDisplay = document.getElementById('pinDisplay');
  const pinError = document.getElementById('pinError');
  const keypad = document.getElementById('pinKeypad');
  let entered = '';

  function renderPin() {
    const masked = entered.split('').map(()=> '‚Ä¢').join('');
    pinDisplay.textContent = (masked + '----').slice(0,4);
    pinError.textContent = '';
  }

  function unlock() {
    if (entered.length !== 4) {
      pinError.textContent = 'Voer 4 cijfers in';
      return;
    }
    if (entered === CORRECT_PIN) {
      overlay.style.display = 'none';
      overlay.setAttribute('aria-hidden','true');
      // optioneel: focus terug naar je app
      document.body.focus();
    } else {
      pinError.textContent = 'Onjuiste pincode';
      setTimeout(()=> { entered=''; renderPin(); }, 600);
    }
  }

  keypad.addEventListener('click', (ev)=>{
    const t = ev.target;
    if (!t.classList.contains('pinKey')) return;
    const v = t.textContent.trim();
    if (v === '‚Üê') {
      entered = entered.slice(0,-1);
      renderPin();
    } else if (v === 'Ontgrendel') {
      unlock();
    } else if (/^\d$/.test(v)) {
      if (entered.length < 4) {
        entered += v;
        renderPin();
      }
    }
  });

  // keyboard support
  window.addEventListener('keydown', (e)=>{
    if (overlay.style.display === 'none') return;
    if (e.key >= '0' && e.key <= '9') {
      if (entered.length < 4) { entered += e.key; renderPin(); }
      e.preventDefault();
    } else if (e.key === 'Backspace') {
      entered = entered.slice(0,-1); renderPin(); e.preventDefault();
    } else if (e.key === 'Enter') {
      unlock(); e.preventDefault();
    }
  });

  // init
  renderPin();
</script> 
</body>
</html>


