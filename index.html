<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kart Problemen Dashboard v1.1</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00c896">

<style>
:root {
  --bg:#0f1115; --fg:#f0f0f0; --accent:#00c896;
  --card:#1a1d24; --border:#2a2d34;
  --open:#e74c3c; --solved:#27ae60; --shadow:rgba(0,0,0,0.4);
}
body.light {
  --bg:#f8f8f8; --fg:#111; --accent:#00846a;
  --card:#fff; --border:#ccc; --open:#c0392b;
  --solved:#27ae60; --shadow:rgba(0,0,0,0.1);
}
body {
  background:var(--bg); color:var(--fg);
  font-family:"Segoe UI",sans-serif; margin:0;
  transition:background .3s,color .3s;
}

/* Header */
header {
  display:flex; justify-content:space-between; align-items:center;
  background:var(--card); padding:15px 25px;
  box-shadow:0 2px 10px var(--shadow); position:sticky; top:0; z-index:100;
}
h1 {font-size:1.4rem;}
#modeToggle {
  background:var(--accent); border:none; border-radius:50%;
  width:38px; height:38px; color:#fff; font-size:18px; cursor:pointer;
}

/* Sync indicator */
#syncStatus {
  font-size:0.85rem; color:#aaa; text-align:center; margin-top:8px;
}

/* Layout */
main {max-width:1100px; margin:auto; padding:20px;}

/* Stats */
.stats {
  display:flex; flex-wrap:wrap; justify-content:space-around;
  gap:10px; margin-bottom:25px;
}
.stat {
  flex:1; min-width:180px; text-align:center;
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; box-shadow:0 2px 10px var(--shadow);
  padding:15px;
}
.stat h2 {margin:0; font-size:2rem;}
.stat p {margin:5px 0 0; color:#aaa;}

/* Forms */
form,.filters {
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; padding:15px; margin-bottom:20px;
  box-shadow:0 2px 10px var(--shadow);
}
input,select,button {
  padding:8px; margin:5px; border-radius:5px;
  border:1px solid var(--border); background:#222; color:var(--fg);
}
body.light input,body.light select,body.light button{background:#fff;color:#000;}
button{cursor:pointer;background:var(--accent);color:#fff;border:none;}
button:hover{opacity:.9;}

/* Cards */
.cards {
  display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:15px;
}
.card {
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; box-shadow:0 2px 10px var(--shadow);
  padding:12px 15px; display:flex; flex-direction:column; justify-content:space-between;
}
.card.open {border-left:6px solid var(--open);}
.card.opgelost {border-left:6px solid var(--solved);opacity:.85;}
.card h3{margin:0;font-size:1.1rem;}
.card small{color:#aaa;}
.status{font-weight:bold;color:var(--accent);}
.solveBtn {background:var(--solved);margin-top:8px;}
.solveBtn:disabled{background:#444;cursor:not-allowed;}
</style>

<!-- PIN overlay CSS -->
<style>
/* Donkere modal (Optie B) ‚Äî met aangepaste knoppen en leesbaarheid */
#pinOverlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.94);
  z-index: 99999;
  -webkit-tap-highlight-color: transparent;
  /* fallback hard override to reduce chance of being hidden by other CSS:
     this ensures the overlay is visible unless explicitly removed. */
}
#pinOverlay[hidden] { display:none !important; }

#pinCard {
  background: #0b0c0d;
  color: #f8fafc;
  border-radius: 12px;
  padding: 22px;
  width: 380px;
  max-width: 94%;
  box-shadow: 0 22px 60px rgba(0,0,0,0.75);
  text-align: center;
  border: 1px solid rgba(255,255,255,0.04);
  font-family: inherit;
}

#pinTitle { margin: 0 0 10px; font-size: 18px; font-weight: 600; color: #ffffff; }

/* PIN display */
#pinDisplay {
  height:56px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.06);
  display:flex;
  align-items:center;
  justify-content:center;
  margin: 0 auto 14px;
  font-size:28px;
  letter-spacing:14px;
  background: rgba(255,255,255,0.02);
  user-select:none;
  color: #fff;
  width: 86%;
  max-width: 320px;
  box-sizing: border-box;
}

/* Numpad grid */
.pinKeypad { display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-top:6px; }

/* Keys ‚Äî GROTER en DIK gedrukt */
.pinKey {
  padding:14px;
  border-radius:10px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.04);
  cursor:pointer;
  user-select:none;
  font-size:20px;          /* groter */
  font-weight:700;         /* dikker */
  color: #ffffff;
  min-height:60px;         /* grotere hit-area */
  display:flex;
  align-items:center;
  justify-content:center;
  transition: transform .06s ease, background .12s ease, box-shadow .06s ease;
  box-shadow: 0 1px 0 rgba(0,0,0,0.25) inset;
}
.pinKey:active { transform: translateY(1px); filter:brightness(0.98); }
.pinKey:focus { outline:none; box-shadow: 0 0 0 3px rgba(255,255,255,0.08), 0 6px 20px rgba(0,0,0,0.6); }

/* Ontgrendel knop: gewenste kleur en extra vet */
.pinKey.wide {
  grid-column: 1 / -1;
  background: #e10a8c;     /* EXACTe kleur zoals gevraagd */
  color: #fff;
  font-weight:800;
  font-size:18px;
  border: 1px solid rgba(0,0,0,0.35);
  min-height:62px;
  box-shadow: 0 6px 18px rgba(225,10,140,0.14);
}
.pinKey.wide:hover { filter: brightness(1.03); }

/* Error tekst */
#pinError { color: #ffb3b3; min-height:22px; margin-top:12px; font-size:13px; line-height:1; }

#pinCard .small-note { margin-top:10px; font-size:12px; color: rgba(255,255,255,0.68); }

/* Responsive */
@media (max-width:420px){
  #pinCard { width: 92%; padding:16px; }
  #pinDisplay { font-size:22px; height:50px; letter-spacing:10px; max-width:280px; }
  .pinKey { font-size:19px; padding:12px; min-height:52px; }
  .pinKey.wide { min-height:54px; font-size:17px; }
}
</style>
</head>
<body>
<header>
  <h1>üèéÔ∏è Kart Problemen Dashboard</h1>
  <button id="modeToggle">‚òÄÔ∏è</button>
</header>

<main>
  <div id="syncStatus" style="text-align:center; margin-top:10px; color:#ccc;">
    üèÅ Bezig met laden‚Ä¶
  </div>

  <div class="stats">
    <div class="stat"><h2 id="totalProblems">0</h2><p>Totaal meldingen</p></div>
    <div class="stat"><h2 id="openProblems">0</h2><p>Karts met problemen</p></div>
    <div class="stat"><h2 id="workingKarts">0</h2><p>Werkende karts</p></div>
  </div>

  <form id="addForm">
    <select id="kart" required><option value="">Kart...</option></select>
    <input id="probleem" placeholder="Probleem" required>
    <input id="melder" placeholder="Melder" required>
    <button type="submit">‚ûï Toevoegen</button>
  </form>

  <div class="filters">
    <label>Kart:
      <select id="filterKart"><option value="">Alle</option></select>
    </label>
    <label>Status:
      <select id="filterStatus">
        <option value="">Alle</option><option value="open">Open</option><option value="opgelost">Opgelost</option>
      </select>
    </label>
    <button id="clearFilters">‚ùå Wissen</button>
  </div>

  <div class="cards" id="cards"></div>
</main>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbyV2YCK6qVc60A-ktS33beE5T7wupJXadiyn_hHPtsXIrP5tq5aIIjHCacLq_LE8yryig/exec";

for(let i=1;i<=40;i++){
  document.querySelector("#kart").innerHTML+=`<option>${i}</option>`;
  document.querySelector("#filterKart").innerHTML+=`<option>${i}</option>`;
}

let all=[];
const syncStatus=document.getElementById("syncStatus");

async function load(){
  syncStatus.textContent="üîÑ Data verversen...";
  try{
    const r=await fetch(SHEET_URL+"?t="+Date.now());
    const d=await r.json();
    all=d.slice(1).map(r=>({datum:r[0],kart:r[1],probleem:r[2],melder:r[3],status:r[4]||"open"}));
    renderDashboard(); renderCards();
    syncStatus.textContent="‚úÖ Gesynchroniseerd ("+new Date().toLocaleTimeString("nl-NL")+")";
  }catch(err){
    syncStatus.textContent="‚ö†Ô∏è Kon niet verbinden (offline?)";
  }
}

function renderDashboard(){
  const total=all.length;
  const openKarts=new Set(all.filter(p=>p.status==="open").map(p=>p.kart)).size;
  document.getElementById("totalProblems").textContent=total;
  document.getElementById("openProblems").textContent=openKarts;
  document.getElementById("workingKarts").textContent=40-openKarts;
}

function renderCards(){
  const kartF=document.getElementById("filterKart").value;
  const statF=document.getElementById("filterStatus").value;
  const c=document.getElementById("cards"); c.innerHTML="";
  all.filter(p=>(!kartF||p.kart==kartF)&&(!statF||p.status==statF))
     .reverse()
     .forEach(p=>{
        const div=document.createElement("div");
        div.className=`card ${p.status}`;
        div.innerHTML=`
          <h3>Kart ${p.kart}</h3>
          <p>${p.probleem}</p>
          <small>${p.datum} ‚Äì ${p.melder}</small>
          <p class="status">${p.status}</p>
          <button class="solveBtn" ${p.status==="opgelost"?"disabled":""}
            onclick="solve('${p.kart}','${p.probleem}')">‚úÖ Markeer als opgelost</button>`;
        c.appendChild(div);
     });
}

document.getElementById("addForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const body={action:"add",datum:new Date().toLocaleDateString("nl-NL"),
    kart:document.getElementById("kart").value,
    probleem:document.getElementById("probleem").value,
    melder:document.getElementById("melder").value,
    status:"open"};
  await fetch(SHEET_URL,{method:"POST",body:JSON.stringify(body)});
  e.target.reset(); load();
});

async function solve(kart,probleem){
  await fetch(SHEET_URL,{method:"POST",body:JSON.stringify({action:"solve",kart,probleem})});
  load();
}

// Filters
document.getElementById("filterKart").addEventListener("change",renderCards);
document.getElementById("filterStatus").addEventListener("change",renderCards);
document.getElementById("clearFilters").addEventListener("click",()=>{document.getElementById("filterKart").value="";document.getElementById("filterStatus").value="";renderCards();});

// Auto refresh every 60s
setInterval(load,60000);

// Dark/light mode
const body=document.body, toggle=document.getElementById("modeToggle");
toggle.addEventListener("click",()=>{body.classList.toggle("light");toggle.textContent=body.classList.contains("light")?"üåô":"‚òÄÔ∏è";});

// Register service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js')
    .then(()=>console.log("Service Worker ready"))
    .catch(console.error);
}

load();
</script>

<!-- PIN overlay HTML (staat na de hoofdscript zodat het DOM beschikbaar is) -->
<div id="pinOverlay" aria-hidden="false">
  <div id="pinCard" role="dialog" aria-modal="true" aria-labelledby="pinTitle">
    <h3 id="pinTitle">Voer pincode in</h3>
    <div id="pinDisplay">----</div>

    <div class="pinKeypad" id="pinKeypad">
      <div class="pinKey">1</div>
      <div class="pinKey">2</div>
      <div class="pinKey">3</div>
      <div class="pinKey">4</div>
      <div class="pinKey">5</div>
      <div class="pinKey">6</div>
      <div class="pinKey">7</div>
      <div class="pinKey">8</div>
      <div class="pinKey">9</div>
      <div class="pinKey">‚Üê</div>
      <div class="pinKey">0</div>
      <div class="pinKey wide" id="pinEnter">Ontgrendel</div>
    </div>

    <div id="pinError" aria-live="polite"></div>
  </div>
</div>

<!-- PIN script -->
<script>
/* Eenvoudige client-side pincode overlay.
   Houd er rekening mee dat dit alleen client-side is (plaintext in code). */
const CORRECT_PIN = '3120'; // pas aan indien gewenst

const overlay = document.getElementById('pinOverlay');
const pinDisplay = document.getElementById('pinDisplay');
const pinError = document.getElementById('pinError');
const keypad = document.getElementById('pinKeypad');
let entered = '';

// Render de maskering (‚Ä¢) van ingevoerde cijfers
function renderPin() {
  const masked = entered.split('').map(()=> '‚Ä¢').join('');
  pinDisplay.textContent = (masked + '----').slice(0,4);
  pinError.textContent = '';
}

// Controleer en ontgrendel
function unlock() {
  if (entered.length !== 4) {
    pinError.textContent = 'Voer 4 cijfers in';
    return;
  }
  if (entered === CORRECT_PIN) {
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
    document.body.style.overflow = ''; // restore scrolling
    document.body.focus();
  } else {
    pinError.textContent = 'Onjuiste pincode';
    setTimeout(()=> { entered=''; renderPin(); }, 600);
  }
}

// Probeer automatisch wanneer 4 cijfers zijn ingevoerd
function tryAutoUnlockWhenFull() {
  if (entered.length === 4) {
    // korte delay zodat het laatste cijfer zichtbaar is
    setTimeout(unlock, 150);
  }
}

// Klik- en knopafhandeling
keypad.addEventListener('click', (ev)=>{
  const t = ev.target;
  if (!t.classList.contains('pinKey')) return;
  const v = t.textContent.trim();
  if (v === '‚Üê') {
    entered = entered.slice(0,-1);
    renderPin();
  } else if (v === 'Ontgrendel') {
    unlock();
  } else if (/^\d$/.test(v)) {
    if (entered.length < 4) {
      entered += v;
      renderPin();
      tryAutoUnlockWhenFull();
    }
  }
});

// Keyboard support (0-9, Backspace, Enter). Als overlay verborgen is, negeer toetsen.
window.addEventListener('keydown', (e)=>{
  if (overlay.style.display === 'none') return;
  if (e.key >= '0' && e.key <= '9') {
    if (entered.length < 4) {
      entered += e.key;
      renderPin();
      tryAutoUnlockWhenFull();
    }
    e.preventDefault();
  } else if (e.key === 'Backspace') {
    entered = entered.slice(0,-1); renderPin(); e.preventDefault();
  } else if (e.key === 'Enter') {
    unlock(); e.preventDefault();
  }
});

// Init
renderPin();
</script>

<!-- PIN debug: force show (temporary) -->
<script>
(function(){
  window.addEventListener('load', () => {
    console.log('[PIN debug] page loaded ‚Äî checking overlay presence');
    const o = document.getElementById('pinOverlay');
    if (!o) {
      console.error('[PIN debug] #pinOverlay not found ‚Äî deployed index.html might differ');
      return;
    }
    console.log('[PIN debug] overlay found ‚Äî forcing visible and above all (temporary)');
    // Force strong styles so overlay cannot be hidden by other CSS
    o.style.setProperty('display','flex','important');
    o.style.setProperty('position','fixed','important');
    o.style.setProperty('inset','0','important');
    o.style.setProperty('z-index','2147483647','important');
    o.setAttribute('aria-hidden','false');
    // Prevent scrolling while overlay active
    document.body.style.overflow = 'hidden';
    // log computed style
    const cs = getComputedStyle(o);
    console.log('[PIN debug] computed display:', cs.display, 'z-index:', cs.zIndex);
    try{ console.log('[PIN debug] CORRECT_PIN =', typeof CORRECT_PIN !== 'undefined' ? CORRECT_PIN : 'not found'); }catch(e){}
  });
})();
</script>

</body>
</html>
